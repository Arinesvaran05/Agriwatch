import{a as U,b,c as y,d as E,f as D,g as F,h as w,m as I,o as A}from"./chunk-OX5MQXUP.js";import{a as L}from"./chunk-MJYXO2CU.js";import{$ as i,B as m,Ba as M,Ca as S,D as h,Ea as k,Fa as O,H as f,O as d,P as n,Q as t,R as p,T as g,U as v,Z as _,a as x,ba as c,ra as C,ta as P,y as a}from"./chunk-WZYVPUJW.js";function V(l,r){l&1&&(n(0,"div",32),i(1," Name is required "),t())}function z(l,r){l&1&&(n(0,"div",32),i(1," Valid email is required "),t())}function T(l,r){if(l&1&&(n(0,"div",33),i(1),t()),l&2){let o=v();a(),c(" ",o.successMessage," ")}}function R(l,r){if(l&1&&(n(0,"div",34),i(1),t()),l&2){let o=v();a(),c(" ",o.errorMessage," ")}}var N=class l{constructor(r,o,e,s){this.fb=r;this.dataService=o;this.authService=e;this.router=s;this.profileForm=this.fb.group({name:["",b.required],email:["",[b.required,b.email]]})}profileForm;currentUser;isLoading=!1;successMessage="";errorMessage="";ngOnInit(){this.currentUser=this.authService.currentUserValue,console.log("Current user data on init:",this.currentUser),this.currentUser&&(this.profileForm.patchValue({name:this.currentUser.name,email:this.currentUser.email}),this.refreshUserData())}goBack(){this.router.navigate(["/admin/dashboard"])}logout(){this.authService.logout(),this.router.navigate(["/login"])}updateProfile(){if(this.profileForm.valid){this.isLoading=!0,this.successMessage="",this.errorMessage="";let r={id:this.currentUser.id,name:this.profileForm.value.name,email:this.profileForm.value.email};this.dataService.updateProfile(r).subscribe({next:o=>{if(this.isLoading=!1,this.successMessage="Profile updated successfully!",console.log("Profile update response:",o),o.data){let e=x(x({},this.currentUser),o.data);console.log("Updated user data:",e),this.authService.updateCurrentUser(e),this.currentUser=e,this.profileForm.patchValue({name:o.data.name,email:o.data.email})}setTimeout(()=>{this.successMessage=""},3e3)},error:o=>{this.isLoading=!1,this.errorMessage=o.error?.message||"Failed to update profile. Please try again.",setTimeout(()=>{this.errorMessage=""},5e3)}})}}formatDate(r){return r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"}refreshUserData(){this.currentUser?.id&&this.dataService.getUser(this.currentUser.id).subscribe({next:r=>{console.log("Refreshed user data:",r),this.currentUser=r,this.authService.updateCurrentUser(r),this.profileForm.patchValue({name:r.name,email:r.email})},error:r=>{console.error("Failed to refresh user data:",r)}})}static \u0275fac=function(o){return new(o||l)(m(I),m(L),m(O),m(M))};static \u0275cmp=h({type:l,selectors:[["app-admin-profile"]],decls:66,vars:14,consts:[[1,"profile-container"],[1,"profile-header"],[1,"header-content"],[1,"user-info"],[1,"logout-btn",3,"click"],[1,"profile-nav"],["routerLink","/admin/dashboard",1,"nav-item"],["routerLink","/admin/temperature",1,"nav-item"],["routerLink","/admin/humidity",1,"nav-item"],["routerLink","/admin/soil-moisture",1,"nav-item"],["routerLink","/admin/users",1,"nav-item"],["routerLink","/admin/data-visualization",1,"nav-item"],["routerLink","/admin/profile",1,"nav-item","active"],[1,"profile-content"],[1,"back-section"],[1,"back-btn",3,"click"],[1,"profile-card"],[1,"profile-avatar"],[1,"profile-form",3,"ngSubmit","formGroup"],[1,"form-group"],["type","text","formControlName","name","placeholder","Enter your name"],["class","error",4,"ngIf"],["type","email","formControlName","email","placeholder","Enter your email"],["type","text","disabled","",1,"disabled-input",3,"value"],[1,"verification-status"],[1,"form-actions"],["type","submit",1,"update-btn",3,"disabled"],[1,"profile-actions"],["routerLink","/admin/change-password",1,"action-btn"],["routerLink","/admin/data-visualization",1,"action-btn"],["class","success-message",4,"ngIf"],["class","error-message",4,"ngIf"],[1,"error"],[1,"success-message"],[1,"error-message"]],template:function(o,e){if(o&1&&(n(0,"div",0)(1,"header",1)(2,"div",2)(3,"h1"),i(4,"\u{1F464} Admin Profile"),t(),n(5,"div",3)(6,"span"),i(7),t(),n(8,"button",4),g("click",function(){return e.logout()}),i(9,"Sign Out"),t()()()(),n(10,"nav",5)(11,"a",6),i(12,"Dashboard"),t(),n(13,"a",7),i(14,"Temperature"),t(),n(15,"a",8),i(16,"Humidity"),t(),n(17,"a",9),i(18,"Soil Moisture"),t(),n(19,"a",10),i(20,"Users"),t(),n(21,"a",11),i(22,"Data Visualization"),t(),n(23,"a",12),i(24,"Profile"),t()(),n(25,"div",13)(26,"div",14)(27,"button",15),g("click",function(){return e.goBack()}),i(28," \u2190 Back to Dashboard "),t()(),n(29,"div",16)(30,"div",17),i(31),t(),n(32,"form",18),g("ngSubmit",function(){return e.updateProfile()}),n(33,"div",19)(34,"label"),i(35,"Name"),t(),p(36,"input",20),f(37,V,2,0,"div",21),t(),n(38,"div",19)(39,"label"),i(40,"Email"),t(),p(41,"input",22),f(42,z,2,0,"div",21),t(),n(43,"div",19)(44,"label"),i(45,"Role"),t(),p(46,"input",23),t(),n(47,"div",19)(48,"label"),i(49,"Email Verification"),t(),n(50,"div",24),i(51),t()(),n(52,"div",19)(53,"label"),i(54,"Account Created"),t(),p(55,"input",23),t(),n(56,"div",25)(57,"button",26),i(58),t()()()(),n(59,"div",27)(60,"a",28),i(61," \u{1F512} Change Password "),t(),n(62,"a",29),i(63," \u{1F4CA} Data Visualization "),t()()(),f(64,T,2,1,"div",30)(65,R,2,1,"div",31),t()),o&2){let s,u;a(7),c("Welcome, ",e.currentUser==null?null:e.currentUser.name),a(24),c(" ",(e.currentUser==null||e.currentUser.name==null?null:e.currentUser.name.charAt(0).toUpperCase())||"A"," "),a(),d("formGroup",e.profileForm),a(5),d("ngIf",((s=e.profileForm.get("name"))==null?null:s.invalid)&&((s=e.profileForm.get("name"))==null?null:s.touched)),a(5),d("ngIf",((u=e.profileForm.get("email"))==null?null:u.invalid)&&((u=e.profileForm.get("email"))==null?null:u.touched)),a(4),d("value",e.currentUser==null?null:e.currentUser.role),a(4),_("verified",e.currentUser==null?null:e.currentUser.is_email_verified),a(),c(" ",e.currentUser!=null&&e.currentUser.is_email_verified?"\u2713 Verified":"\u2717 Not Verified"," "),a(4),d("value",e.formatDate(e.currentUser==null?null:e.currentUser.created_at)),a(2),d("disabled",e.profileForm.invalid||e.isLoading),a(),c(" ",e.isLoading?"Updating...":"Update Profile"," "),a(6),d("ngIf",e.successMessage),a(),d("ngIf",e.errorMessage)}},dependencies:[P,C,A,D,U,y,E,F,w,k,S],styles:[".profile-container[_ngcontent-%COMP%]{min-height:calc(100vh - 200px);background:#f8f9fa;padding-bottom:20px}.profile-header[_ngcontent-%COMP%]{background:linear-gradient(135deg,#17a2b8,#20c997);color:#fff;padding:20px 0;box-shadow:0 2px 10px #0000001a}.header-content[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:0 20px;display:flex;justify-content:space-between;align-items:center}.header-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:2rem}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px}.logout-btn[_ngcontent-%COMP%]{background:#fff3;color:#fff;border:1px solid rgba(255,255,255,.3);padding:8px 16px;border-radius:8px;cursor:pointer;transition:background .3s ease}.logout-btn[_ngcontent-%COMP%]:hover{background:#ffffff4d}.profile-nav[_ngcontent-%COMP%]{background:#fff;padding:0 40px;border-bottom:1px solid #e1e8ed}.nav-item[_ngcontent-%COMP%]{display:inline-block;padding:15px 20px;color:#7f8c8d;text-decoration:none;border-bottom:3px solid transparent;transition:all .3s ease}.nav-item[_ngcontent-%COMP%]:hover, .nav-item.active[_ngcontent-%COMP%]{color:#17a2b8;border-bottom-color:#17a2b8}.profile-content[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;padding:30px 20px}.back-section[_ngcontent-%COMP%]{margin-bottom:20px}.back-btn[_ngcontent-%COMP%]{background:#6c757d;color:#fff;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;font-weight:500;transition:background .3s ease}.back-btn[_ngcontent-%COMP%]:hover{background:#5a6268}.profile-card[_ngcontent-%COMP%]{background:#fff;border-radius:16px;padding:40px;box-shadow:0 8px 32px #0000001a;text-align:center;margin-bottom:20px}.profile-avatar[_ngcontent-%COMP%]{width:100px;height:100px;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;display:flex;align-items:center;justify-content:center;font-size:36px;font-weight:700;margin:0 auto 30px}.profile-form[_ngcontent-%COMP%]{max-width:400px;margin:0 auto}.form-group[_ngcontent-%COMP%]{margin-bottom:20px;text-align:left}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;color:#2c3e50;font-weight:600}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:12px 16px;border:2px solid #e1e8ed;border-radius:10px;font-size:16px;transition:border-color .3s ease;box-sizing:border-box}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:#667eea}.disabled-input[_ngcontent-%COMP%]{background-color:#f8f9fa;color:#6c757d;cursor:not-allowed}.verification-status[_ngcontent-%COMP%]{padding:8px 16px;border-radius:20px;font-size:14px;font-weight:600;background:#f8d7da;color:#721c24}.verification-status.verified[_ngcontent-%COMP%]{background:#d4edda;color:#155724}.error[_ngcontent-%COMP%]{color:#e74c3c;font-size:14px;margin-top:5px}.form-actions[_ngcontent-%COMP%]{margin-top:30px}.update-btn[_ngcontent-%COMP%]{width:100%;padding:14px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;transition:transform .2s ease}.update-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px)}.update-btn[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}.profile-actions[_ngcontent-%COMP%]{display:grid;gap:15px}.action-btn[_ngcontent-%COMP%]{display:block;padding:16px 24px;background:#fff;color:#2c3e50;text-decoration:none;border-radius:12px;text-align:center;font-weight:600;box-shadow:0 4px 6px #0000001a;transition:all .3s ease;border:2px solid transparent}.action-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);border-color:#667eea;color:#667eea}.success-message[_ngcontent-%COMP%]{background:#d4edda;color:#155724;padding:12px 20px;border-radius:8px;margin-top:20px;text-align:center;border:1px solid #c3e6cb}.error-message[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24;padding:12px 20px;border-radius:8px;margin-top:20px;text-align:center;border:1px solid #f5c6cb}@media (max-width: 768px){.header-content[_ngcontent-%COMP%]{flex-direction:column;gap:15px;text-align:center}.profile-card[_ngcontent-%COMP%]{padding:20px}}"]})};export{N as AdminProfileComponent};
