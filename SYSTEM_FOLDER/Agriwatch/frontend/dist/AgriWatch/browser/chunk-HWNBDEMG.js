import{a as T,b as f,c as D,d as N,f as R,g as G,h as z,l as B,m as L,o as q}from"./chunk-OX5MQXUP.js";import{$ as a,B as b,Ba as V,D as S,Ea as I,Fa as k,H as p,N as P,O as c,P as n,Q as i,R as h,S as y,T as g,U as m,Z as w,aa as E,ba as M,p as u,q as _,ra as O,ta as F,y as o}from"./chunk-WZYVPUJW.js";function H(e,s){e&1&&(n(0,"span",27),a(1,"\u{1F441}"),i())}function j(e,s){e&1&&(n(0,"span",28),a(1,"\u{1F6AB}"),i())}function Y(e,s){e&1&&(n(0,"div",29),a(1," Current password is required "),i())}function U(e,s){e&1&&(n(0,"span",27),a(1,"\u{1F441}"),i())}function W(e,s){e&1&&(n(0,"span",28),a(1,"\u{1F6AB}"),i())}function $(e,s){e&1&&(n(0,"div",29),a(1," Password must be at least 6 characters long "),i())}function J(e,s){e&1&&(n(0,"span",27),a(1,"\u{1F441}"),i())}function K(e,s){e&1&&(n(0,"span",28),a(1,"\u{1F6AB}"),i())}function Q(e,s){e&1&&(n(0,"span"),a(1,"Confirm password is required"),i())}function X(e,s){e&1&&(n(0,"span"),a(1,"Passwords do not match"),i())}function Z(e,s){if(e&1&&(n(0,"div",29),p(1,Q,2,0,"span",26)(2,X,2,0,"span",26),i()),e&2){let t,l,r=m(2);o(),c("ngIf",(t=r.changeForm.get("confirm_password"))==null?null:t.hasError("required")),o(),c("ngIf",!((l=r.changeForm.get("confirm_password"))!=null&&l.hasError("required"))&&r.changeForm.hasError("passwordMismatch"))}}function ee(e,s){e&1&&(n(0,"span"),a(1,"Send Verification Code"),i())}function te(e,s){e&1&&(n(0,"span"),a(1,"Sending..."),i())}function ne(e,s){if(e&1){let t=y();n(0,"div",10)(1,"p",11),a(2," Enter your current password and new password to change your account password. "),i(),n(3,"form",12),g("ngSubmit",function(){u(t);let r=m();return _(r.onSubmit())}),n(4,"div",13)(5,"label",14),a(6,"Current Password"),i(),n(7,"div",15),h(8,"input",16),n(9,"button",17),g("click",function(){u(t);let r=m();return _(r.toggleCurrentPasswordVisibility())}),p(10,H,2,0,"span",18)(11,j,2,0,"span",19),i()(),p(12,Y,2,0,"div",20),i(),n(13,"div",13)(14,"label",21),a(15,"New Password"),i(),n(16,"div",15),h(17,"input",22),n(18,"button",17),g("click",function(){u(t);let r=m();return _(r.toggleNewPasswordVisibility())}),p(19,U,2,0,"span",18)(20,W,2,0,"span",19),i()(),p(21,$,2,0,"div",20),i(),n(22,"div",13)(23,"label",23),a(24,"Confirm New Password"),i(),n(25,"div",15),h(26,"input",24),n(27,"button",17),g("click",function(){u(t);let r=m();return _(r.toggleConfirmPasswordVisibility())}),p(28,J,2,0,"span",18)(29,K,2,0,"span",19),i()(),p(30,Z,3,2,"div",20),i(),n(31,"button",25),p(32,ee,2,0,"span",26)(33,te,2,0,"span",26),i()()()}if(e&2){let t,l,r,C,v,x,d=m();o(3),c("formGroup",d.changeForm),o(5),w("error",((t=d.changeForm.get("current_password"))==null?null:t.invalid)&&((t=d.changeForm.get("current_password"))==null?null:t.touched)),c("type",d.showCurrentPassword?"text":"password"),o(),P("aria-label",d.showCurrentPassword?"Hide current password":"Show current password"),o(),c("ngIf",!d.showCurrentPassword),o(),c("ngIf",d.showCurrentPassword),o(),c("ngIf",((l=d.changeForm.get("current_password"))==null?null:l.invalid)&&((l=d.changeForm.get("current_password"))==null?null:l.touched)),o(5),w("error",((r=d.changeForm.get("new_password"))==null?null:r.invalid)&&((r=d.changeForm.get("new_password"))==null?null:r.touched)),c("type",d.showNewPassword?"text":"password"),o(),P("aria-label",d.showNewPassword?"Hide new password":"Show new password"),o(),c("ngIf",!d.showNewPassword),o(),c("ngIf",d.showNewPassword),o(),c("ngIf",((C=d.changeForm.get("new_password"))==null?null:C.invalid)&&((C=d.changeForm.get("new_password"))==null?null:C.touched)),o(5),w("error",((v=d.changeForm.get("confirm_password"))==null?null:v.invalid)&&((v=d.changeForm.get("confirm_password"))==null?null:v.touched)||d.changeForm.hasError("passwordMismatch")),c("type",d.showConfirmPassword?"text":"password"),o(),P("aria-label",d.showConfirmPassword?"Hide confirm password":"Show confirm password"),o(),c("ngIf",!d.showConfirmPassword),o(),c("ngIf",d.showConfirmPassword),o(),c("ngIf",((x=d.changeForm.get("confirm_password"))==null?null:x.invalid)&&((x=d.changeForm.get("confirm_password"))==null?null:x.touched)||d.changeForm.hasError("passwordMismatch")),o(),c("disabled",d.changeForm.invalid||d.isLoading),o(),c("ngIf",!d.isLoading),o(),c("ngIf",d.isLoading)}}function ie(e,s){e&1&&(n(0,"div",29),a(1," Please enter a valid 4-digit code "),i())}function re(e,s){e&1&&(n(0,"span"),a(1,"Confirm Password Change"),i())}function oe(e,s){e&1&&(n(0,"span"),a(1,"Verifying..."),i())}function ae(e,s){e&1&&(n(0,"span"),a(1,"Resend Code"),i())}function se(e,s){e&1&&(n(0,"span"),a(1,"Sending..."),i())}function ce(e,s){if(e&1){let t=y();n(0,"div",30)(1,"p",11),a(2," We've sent a 4-digit verification code to "),n(3,"strong"),a(4),i()(),n(5,"form",31),g("ngSubmit",function(){u(t);let r=m();return _(r.onVerificationSubmit())}),n(6,"div",13)(7,"label",32),a(8,"Verification Code"),i(),h(9,"input",33),p(10,ie,2,0,"div",20),i(),n(11,"button",34),p(12,re,2,0,"span",26)(13,oe,2,0,"span",26),i()(),n(14,"div",35)(15,"p"),a(16,"Didn't receive the code?"),i(),n(17,"button",36),g("click",function(){u(t);let r=m();return _(r.resendCode())}),p(18,ae,2,0,"span",26)(19,se,2,0,"span",26),i()()()}if(e&2){let t,l,r=m();o(4),E(r.userEmail),o(),c("formGroup",r.verificationForm),o(4),w("error",((t=r.verificationForm.get("verification_code"))==null?null:t.invalid)&&((t=r.verificationForm.get("verification_code"))==null?null:t.touched)),o(),c("ngIf",((l=r.verificationForm.get("verification_code"))==null?null:l.invalid)&&((l=r.verificationForm.get("verification_code"))==null?null:l.touched)),o(),c("disabled",r.verificationForm.invalid||r.isVerifying),o(),c("ngIf",!r.isVerifying),o(),c("ngIf",r.isVerifying),o(4),c("disabled",r.isResending),o(),c("ngIf",!r.isResending),o(),c("ngIf",r.isResending)}}function de(e,s){if(e&1){let t=y();n(0,"div",37)(1,"div",38),a(2,"\u2705"),i(),n(3,"h2"),a(4,"Password Changed Successfully!"),i(),n(5,"p"),a(6,"Your password has been changed. You can now log in with your new password."),i(),n(7,"button",39),g("click",function(){u(t);let r=m();return _(r.goToDashboard())}),a(8,"Go to Dashboard"),i()()}}function le(e,s){if(e&1&&(n(0,"div",40),a(1),i()),e&2){let t=m();o(),M(" ",t.errorMessage," ")}}function pe(e,s){if(e&1&&(n(0,"div",41),a(1),i()),e&2){let t=m();o(),M(" ",t.successMessage," ")}}var A=class e{constructor(s,t,l){this.fb=s;this.authService=t;this.router=l;this.changeForm=this.fb.group({current_password:["",[f.required]],new_password:["",[f.required,f.minLength(6)]],confirm_password:["",[f.required]]},{validators:this.passwordMatchValidator}),this.verificationForm=this.fb.group({verification_code:["",[f.required,f.pattern(/^\d{4}$/)]]});let r=this.authService.currentUserValue;r&&(this.userEmail=r.email)}changeForm;verificationForm;isLoading=!1;isVerifying=!1;isResending=!1;isVerificationSent=!1;isPasswordChanged=!1;errorMessage="";successMessage="";userEmail="";tempPasswordHash="";showCurrentPassword=!1;showNewPassword=!1;showConfirmPassword=!1;passwordMatchValidator(s){let t=s.get("new_password")?.value,l=s.get("confirm_password")?.value;return t===l?null:{passwordMismatch:!0}}toggleCurrentPasswordVisibility(){this.showCurrentPassword=!this.showCurrentPassword}toggleNewPasswordVisibility(){this.showNewPassword=!this.showNewPassword}toggleConfirmPasswordVisibility(){this.showConfirmPassword=!this.showConfirmPassword}onSubmit(){if(this.changeForm.valid){this.isLoading=!0,this.errorMessage="",this.successMessage="";let s={email:this.userEmail,current_password:this.changeForm.value.current_password,new_password:this.changeForm.value.new_password};this.authService.changePassword(s).subscribe({next:t=>{this.isLoading=!1,this.isVerificationSent=!0,this.tempPasswordHash=t.temp_password_hash,this.successMessage=t.message||"Verification code sent successfully!"},error:t=>{this.isLoading=!1,this.errorMessage=t.error?.message||"Failed to send verification code. Please try again."}})}}onVerificationSubmit(){if(this.verificationForm.valid){this.isVerifying=!0,this.errorMessage="",this.successMessage="";let s={email:this.userEmail,verification_code:this.verificationForm.value.verification_code,new_password_hash:this.tempPasswordHash};this.authService.confirmPasswordChange(s).subscribe({next:t=>{this.isVerifying=!1,this.isPasswordChanged=!0,this.successMessage=t.message||"Password changed successfully!"},error:t=>{this.isVerifying=!1,this.errorMessage=t.error?.message||"Failed to change password. Please try again."}})}}resendCode(){this.isResending=!0,this.errorMessage="",this.successMessage="";let s={email:this.userEmail,current_password:this.changeForm.value.current_password,new_password:this.changeForm.value.new_password};this.authService.changePassword(s).subscribe({next:t=>{this.isResending=!1,this.tempPasswordHash=t.temp_password_hash,this.successMessage=t.message||"New verification code sent!"},error:t=>{this.isResending=!1,this.errorMessage=t.error?.message||"Failed to resend code. Please try again."}})}goBack(){this.router.navigate(["/user/profile"])}goToDashboard(){this.router.navigate(["/user/dashboard"])}static \u0275fac=function(t){return new(t||e)(b(L),b(k),b(V))};static \u0275cmp=S({type:e,selectors:[["app-change-password"]],decls:15,vars:5,consts:[[1,"change-container"],[1,"change-card"],[1,"change-header"],["class","change-content",4,"ngIf"],["class","verification-content",4,"ngIf"],["class","success-content",4,"ngIf"],[1,"change-footer"],[1,"back-btn",3,"click"],["class","error-alert",4,"ngIf"],["class","success-alert",4,"ngIf"],[1,"change-content"],[1,"instruction"],[1,"change-form",3,"ngSubmit","formGroup"],[1,"form-group"],["for","currentPassword"],[1,"password-input-container"],["id","currentPassword","formControlName","current_password","placeholder","Enter current password",3,"type"],["type","button",1,"password-toggle",3,"click"],["class","eye-icon",4,"ngIf"],["class","eye-slash-icon",4,"ngIf"],["class","error-message",4,"ngIf"],["for","newPassword"],["id","newPassword","formControlName","new_password","placeholder","Enter new password",3,"type"],["for","confirmPassword"],["id","confirmPassword","formControlName","confirm_password","placeholder","Confirm new password",3,"type"],["type","submit",1,"submit-btn",3,"disabled"],[4,"ngIf"],[1,"eye-icon"],[1,"eye-slash-icon"],[1,"error-message"],[1,"verification-content"],[1,"verification-form",3,"ngSubmit","formGroup"],["for","verificationCode"],["type","text","id","verificationCode","formControlName","verification_code","placeholder","Enter 4-digit code","maxlength","4"],["type","submit",1,"verify-btn",3,"disabled"],[1,"resend-section"],[1,"resend-btn",3,"click","disabled"],[1,"success-content"],[1,"success-icon"],[1,"dashboard-btn",3,"click"],[1,"error-alert"],[1,"success-alert"]],template:function(t,l){t&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),a(4,"\u{1F331} AgriWatch"),i(),n(5,"p"),a(6,"Change Password"),i()(),p(7,ne,34,25,"div",3)(8,ce,20,11,"div",4)(9,de,9,0,"div",5),n(10,"div",6)(11,"button",7),g("click",function(){return l.goBack()}),a(12,"\u2190 Back"),i()(),p(13,le,2,1,"div",8)(14,pe,2,1,"div",9),i()()),t&2&&(o(7),c("ngIf",!l.isVerificationSent),o(),c("ngIf",l.isVerificationSent&&!l.isPasswordChanged),o(),c("ngIf",l.isPasswordChanged),o(4),c("ngIf",l.errorMessage),o(),c("ngIf",l.successMessage))},dependencies:[F,O,q,R,T,D,N,B,G,z,I],styles:[".change-container[_ngcontent-%COMP%]{min-height:calc(100vh - 200px);display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#8e44ad,#9b59b6);padding:20px}.change-card[_ngcontent-%COMP%]{background:#fff;border-radius:20px;box-shadow:0 20px 40px #0000001a;padding:40px;width:100%;max-width:450px}.change-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:30px}.change-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#2c3e50;margin-bottom:10px;font-size:2.5rem}.change-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#7f8c8d;margin:0}.change-content[_ngcontent-%COMP%], .verification-content[_ngcontent-%COMP%]{margin-bottom:20px}.instruction[_ngcontent-%COMP%]{text-align:center;color:#2c3e50;margin-bottom:25px;line-height:1.5}.change-form[_ngcontent-%COMP%], .verification-form[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]{margin-bottom:20px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;color:#2c3e50;font-weight:500}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:12px 16px;border:2px solid #e1e8ed;border-radius:10px;font-size:16px;transition:border-color .3s ease;box-sizing:border-box}.password-input-container[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.password-input-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding-right:50px}.password-toggle[_ngcontent-%COMP%]{position:absolute;right:8px;background:#f5f5f5;border:1px solid #ccc;cursor:pointer;font-size:14px;padding:4px 6px;border-radius:3px;transition:none;display:flex;align-items:center;justify-content:center;width:28px;height:28px;color:#333;font-family:monospace}.password-toggle[_ngcontent-%COMP%]:hover{background-color:#e9e9e9;border-color:#999}.password-toggle[_ngcontent-%COMP%]:focus{outline:1px solid #666;outline-offset:1px}.password-toggle[_ngcontent-%COMP%]:active{background-color:#ddd}.eye-icon[_ngcontent-%COMP%], .eye-slash-icon[_ngcontent-%COMP%]{font-size:12px;line-height:1}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:#667eea}.form-group[_ngcontent-%COMP%]   input.error[_ngcontent-%COMP%]{border-color:#e74c3c}.form-group[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{text-align:center;letter-spacing:4px;font-size:18px}.error-message[_ngcontent-%COMP%]{color:#e74c3c;font-size:14px;margin-top:5px}.submit-btn[_ngcontent-%COMP%], .verify-btn[_ngcontent-%COMP%]{width:100%;padding:14px;background:linear-gradient(135deg,#8e44ad,#9b59b6);color:#fff;border:none;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;transition:transform .2s ease}.submit-btn[_ngcontent-%COMP%]:hover:not(:disabled), .verify-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px)}.submit-btn[_ngcontent-%COMP%]:disabled, .verify-btn[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}.resend-section[_ngcontent-%COMP%]{text-align:center;margin-top:20px;padding-top:20px;border-top:1px solid #e1e8ed}.resend-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#7f8c8d;margin-bottom:10px}.resend-btn[_ngcontent-%COMP%]{background:none;border:2px solid #667eea;color:#667eea;padding:8px 20px;border-radius:8px;font-weight:600;cursor:pointer;transition:all .3s ease}.resend-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#667eea;color:#fff}.resend-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.success-content[_ngcontent-%COMP%]{text-align:center;margin-bottom:20px}.success-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:20px}.success-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#27ae60;margin-bottom:15px}.success-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#7f8c8d;margin-bottom:25px}.dashboard-btn[_ngcontent-%COMP%]{background:linear-gradient(135deg,#27ae60,#2ecc71);color:#fff;border:none;padding:12px 30px;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;transition:transform .2s ease}.dashboard-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.change-footer[_ngcontent-%COMP%]{text-align:center;margin-top:20px}.back-btn[_ngcontent-%COMP%]{background:none;border:2px solid #667eea;color:#667eea;padding:10px 20px;border-radius:8px;font-weight:600;cursor:pointer;transition:all .3s ease}.back-btn[_ngcontent-%COMP%]:hover{background:#667eea;color:#fff}.error-alert[_ngcontent-%COMP%]{background:#fee;color:#e74c3c;padding:12px;border-radius:8px;margin-top:20px;text-align:center;border:1px solid #fcc}.success-alert[_ngcontent-%COMP%]{background:#efe;color:#27ae60;padding:12px;border-radius:8px;margin-top:20px;text-align:center;border:1px solid #cfc}"]})};export{A as ChangePasswordComponent};
