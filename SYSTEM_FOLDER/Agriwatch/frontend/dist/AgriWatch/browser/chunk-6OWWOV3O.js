import{a as w,b as f,c as T,d as U,f as L,g as z,h as N,m as V,o as A}from"./chunk-OX5MQXUP.js";import{a as B}from"./chunk-MJYXO2CU.js";import{$ as r,B as m,Ba as E,Ca as F,D as P,Ea as D,Fa as I,H as p,O as s,P as n,Q as e,R as u,T as c,U as h,Z as C,a as x,ba as _,ha as M,ia as S,ra as O,sa as k,ta as y,y as a}from"./chunk-WZYVPUJW.js";function G(i,l){i&1&&(n(0,"div",33),r(1," Full name is required "),e())}function j(i,l){i&1&&(n(0,"div",33),r(1," Please enter a valid email address "),e())}function q(i,l){i&1&&(n(0,"span"),r(1,"Save Changes"),e())}function H(i,l){i&1&&(n(0,"span"),r(1,"Saving..."),e())}function W(i,l){if(i&1&&(n(0,"div",34),r(1),e()),i&2){let o=h();a(),_(" ",o.successMessage," ")}}function Y(i,l){if(i&1&&(n(0,"div",35),r(1),e()),i&2){let o=h();a(),_(" ",o.errorMessage," ")}}var R=class i{constructor(l,o,t,d){this.authService=l;this.dataService=o;this.router=t;this.fb=d;this.currentUser=this.authService.currentUserValue,this.profileForm=this.fb.group({name:["",[f.required,f.minLength(2)]],email:["",[f.required,f.email]]})}currentUser;profileForm;isLoading=!1;successMessage="";errorMessage="";ngOnInit(){this.loadProfileData()}loadProfileData(){this.currentUser&&this.profileForm.patchValue({name:this.currentUser.name,email:this.currentUser.email})}goBack(){this.router.navigate(["/user/dashboard"])}onSubmit(){if(this.profileForm.valid){this.isLoading=!0,this.successMessage="",this.errorMessage="";let l={id:this.currentUser.id,name:this.profileForm.value.name,email:this.profileForm.value.email};console.log("Current user:",this.currentUser),console.log("Profile form values:",this.profileForm.value),console.log("Sending profile data:",l),this.dataService.updateProfile(l).subscribe({next:o=>{console.log("Profile update successful:",o),this.isLoading=!1,this.successMessage="Profile updated successfully!",this.currentUser=x(x({},this.currentUser),l),this.authService.updateCurrentUser(this.currentUser),setTimeout(()=>{this.successMessage=""},3e3)},error:o=>{console.error("Profile update error:",o),console.error("Error details:",o.error),console.error("Error message:",o.error?.message),this.isLoading=!1,this.errorMessage=o.error?.message||"Failed to update profile. Please try again.",setTimeout(()=>{this.errorMessage=""},5e3)}})}}navigateToChangePassword(){this.router.navigate(["/user/change-password"])}navigateToDataVisualization(){this.router.navigate(["/user/data-visualization"])}logout(){this.authService.logout(),this.router.navigate(["/login"])}static \u0275fac=function(o){return new(o||i)(m(I),m(B),m(E),m(V))};static \u0275cmp=P({type:i,selectors:[["app-profile"]],decls:60,vars:18,consts:[[1,"profile-container"],[1,"profile-header"],[1,"header-content"],[1,"user-info"],[1,"logout-btn",3,"click"],[1,"profile-nav"],["routerLink","/user/dashboard",1,"nav-item"],["routerLink","/user/temperature",1,"nav-item"],["routerLink","/user/humidity",1,"nav-item"],["routerLink","/user/soil-moisture",1,"nav-item"],["routerLink","/user/data-visualization",1,"nav-item"],["routerLink","/user/profile",1,"nav-item","active"],[1,"profile-main"],[1,"back-section"],[1,"back-btn",3,"click"],[1,"profile-card"],[1,"profile-form",3,"ngSubmit","formGroup"],[1,"form-group"],["for","name"],["type","text","id","name","formControlName","name","placeholder","Enter your full name"],["class","error-message",4,"ngIf"],["for","email"],["type","email","id","email","formControlName","email","placeholder","Enter your email"],["for","role"],["type","text","id","role","readonly","",1,"readonly",3,"value"],["for","createdAt"],["type","text","id","createdAt","readonly","",1,"readonly",3,"value"],["type","submit",1,"save-btn",3,"disabled"],[4,"ngIf"],[1,"profile-actions"],[1,"action-btn",3,"click"],["class","success-alert",4,"ngIf"],["class","error-alert",4,"ngIf"],[1,"error-message"],[1,"success-alert"],[1,"error-alert"]],template:function(o,t){if(o&1&&(n(0,"div",0)(1,"header",1)(2,"div",2)(3,"h1"),r(4,"\u{1F464} User Profile"),e(),n(5,"div",3)(6,"span"),r(7),e(),n(8,"button",4),c("click",function(){return t.logout()}),r(9,"Sign Out"),e()()()(),n(10,"nav",5)(11,"a",6),r(12,"Dashboard"),e(),n(13,"a",7),r(14,"Temperature"),e(),n(15,"a",8),r(16,"Humidity"),e(),n(17,"a",9),r(18,"Soil Moisture"),e(),n(19,"a",10),r(20,"Data Visualization"),e(),n(21,"a",11),r(22,"Profile"),e()(),n(23,"main",12)(24,"div",13)(25,"button",14),c("click",function(){return t.goBack()}),r(26," \u2190 Back to Dashboard "),e()(),n(27,"div",15)(28,"h2"),r(29,"Profile Information"),e(),n(30,"form",16),c("ngSubmit",function(){return t.onSubmit()}),n(31,"div",17)(32,"label",18),r(33,"Full Name"),e(),u(34,"input",19),p(35,G,2,0,"div",20),e(),n(36,"div",17)(37,"label",21),r(38,"Email"),e(),u(39,"input",22),p(40,j,2,0,"div",20),e(),n(41,"div",17)(42,"label",23),r(43,"Role"),e(),u(44,"input",24),e(),n(45,"div",17)(46,"label",25),r(47,"Account Created"),e(),u(48,"input",26),M(49,"date"),e(),n(50,"button",27),p(51,q,2,0,"span",28)(52,H,2,0,"span",28),e()(),n(53,"div",29)(54,"button",30),c("click",function(){return t.navigateToChangePassword()}),r(55,"Change Password"),e(),n(56,"button",30),c("click",function(){return t.navigateToDataVisualization()}),r(57,"\u{1F4CA} Data Visualization"),e()(),p(58,W,2,1,"div",31)(59,Y,2,1,"div",32),e()()()),o&2){let d,g,b,v;a(7),_("Welcome, ",t.currentUser==null?null:t.currentUser.name),a(23),s("formGroup",t.profileForm),a(4),C("error",((d=t.profileForm.get("name"))==null?null:d.invalid)&&((d=t.profileForm.get("name"))==null?null:d.touched)),a(),s("ngIf",((g=t.profileForm.get("name"))==null?null:g.invalid)&&((g=t.profileForm.get("name"))==null?null:g.touched)),a(4),C("error",((b=t.profileForm.get("email"))==null?null:b.invalid)&&((b=t.profileForm.get("email"))==null?null:b.touched)),a(),s("ngIf",((v=t.profileForm.get("email"))==null?null:v.invalid)&&((v=t.profileForm.get("email"))==null?null:v.touched)),a(4),s("value",t.currentUser==null?null:t.currentUser.role),a(4),s("value",S(49,15,t.currentUser==null?null:t.currentUser.created_at,"medium")),a(2),s("disabled",t.profileForm.invalid||t.isLoading),a(),s("ngIf",!t.isLoading),a(),s("ngIf",t.isLoading),a(6),s("ngIf",t.successMessage),a(),s("ngIf",t.errorMessage)}},dependencies:[y,O,A,L,w,T,U,z,N,D,F,k],styles:[".profile-container[_ngcontent-%COMP%]{min-height:calc(100vh - 200px);background:#f8f9fa;padding-bottom:20px}.profile-header[_ngcontent-%COMP%]{background:linear-gradient(135deg,#8e44ad,#9b59b6);color:#fff;padding:20px 0;box-shadow:0 2px 10px #0000001a}.header-content[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:0 20px;display:flex;justify-content:space-between;align-items:center}.header-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:2rem}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px}.logout-btn[_ngcontent-%COMP%]{background:#fff3;color:#fff;border:1px solid rgba(255,255,255,.3);padding:8px 16px;border-radius:8px;cursor:pointer;transition:background .3s ease}.logout-btn[_ngcontent-%COMP%]:hover{background:#ffffff4d}.profile-nav[_ngcontent-%COMP%]{background:#fff;padding:0 40px;border-bottom:1px solid #e1e8ed}.nav-item[_ngcontent-%COMP%]{display:inline-block;padding:15px 20px;color:#7f8c8d;text-decoration:none;border-bottom:3px solid transparent;transition:all .3s ease}.nav-item[_ngcontent-%COMP%]:hover, .nav-item.active[_ngcontent-%COMP%]{color:#8e44ad;border-bottom-color:#8e44ad}.profile-main[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;padding:30px 20px}.back-section[_ngcontent-%COMP%]{margin-bottom:20px}.back-btn[_ngcontent-%COMP%]{background:#6c757d;color:#fff;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;font-weight:500;transition:background .3s ease}.back-btn[_ngcontent-%COMP%]:hover{background:#5a6268}.profile-card[_ngcontent-%COMP%]{background:#fff;border-radius:15px;padding:40px;box-shadow:0 5px 15px #00000014}.profile-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#2c3e50;margin-bottom:30px;font-size:1.8rem;text-align:center}.profile-form[_ngcontent-%COMP%]{margin-bottom:30px}.form-group[_ngcontent-%COMP%]{margin-bottom:25px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;color:#2c3e50;font-weight:500}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:12px 16px;border:2px solid #e1e8ed;border-radius:10px;font-size:16px;transition:border-color .3s ease;box-sizing:border-box}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:#667eea}.form-group[_ngcontent-%COMP%]   input.error[_ngcontent-%COMP%]{border-color:#e74c3c}.form-group[_ngcontent-%COMP%]   input.readonly[_ngcontent-%COMP%]{background:#f8f9fa;color:#7f8c8d;cursor:not-allowed}.error-message[_ngcontent-%COMP%]{color:#e74c3c;font-size:14px;margin-top:5px}.save-btn[_ngcontent-%COMP%]{width:100%;padding:14px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;transition:transform .2s ease;margin-bottom:20px}.save-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px)}.save-btn[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}.profile-actions[_ngcontent-%COMP%]{text-align:center;margin-bottom:20px}.action-btn[_ngcontent-%COMP%]{padding:12px 24px;background:#27ae60;color:#fff;border:none;border-radius:8px;font-size:14px;font-weight:500;cursor:pointer;transition:background .3s ease}.action-btn[_ngcontent-%COMP%]:hover{background:#229954}.success-alert[_ngcontent-%COMP%]{background:#d4edda;color:#155724;padding:12px;border-radius:8px;margin-top:20px;text-align:center;border:1px solid #c3e6cb}.error-alert[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24;padding:12px;border-radius:8px;margin-top:20px;text-align:center;border:1px solid #f5c6cb}@media (max-width: 768px){.header-content[_ngcontent-%COMP%]{flex-direction:column;gap:15px;text-align:center}.profile-card[_ngcontent-%COMP%]{padding:20px}}"]})};export{R as ProfileComponent};
